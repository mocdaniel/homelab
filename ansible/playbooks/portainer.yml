- name: Install certbot
  hosts: certbot
  become: true
  tags: ["certbot"]
  vars:
    certbot_admin_email: dbodky@gmail.com
    certbot_auto_renew: false
    certbot_create_if_missing: true
    cerbot_install_method: snap
  roles:
    - role: geerlingguy.certbot

- name: Install Portainer
  hosts: portainer
  become: true
  tags: ["portainer"]
  vars:
    portainer_admin_password: !vault |
          $ANSIBLE_VAULT;1.2;AES256;homelab
          61376566393338616436343139363335666330663534343531663039353939383964333335656537
          6339633666396130333334636363656138653762313231660a323436643564383561316564353538
          66303061373136376431646138303336343430323231386264626134396139333534383566346435
          6239666438663135380a306432386463646237383338373364646639393135636434306235613234
          38616438363833313038626566366165323232303737396538626439316238633531626463356531
          30313363663838323637326335396634613665343065616237666366326461623834633938356237
          643335326431386339373964356137303266
    portainer_edition: ee
    portainer_extra_labels:
      traefik.enable: "true"
      traefik.http.routers.portainer.entrypoints: websecure
      traefik.http.routers.portainer.rule: Host(`portainer.bodkys.house`)
      traefik.http.routers.portainer.tls.certresolver: letsencrypt
      traefik.http.routers.portainer.tls: "true"
    portainer_force_https: "true"
    portainer_letsencrypt_domain: portainer.bodkys.house
    portainer_networks:
      - name: traefik
    portainer_license_key: !vault |
          $ANSIBLE_VAULT;1.2;AES256;homelab
          35343065383265313135313465626632656531393431343334643431396563326364316231303961
          6437643435663534363166623632663337343630653139640a363630623931616533333564653135
          32336339343635653737613230613033393732326533633562383839666132386262393666323661
          3662633432303064330a356535363234326437336664306330313134623563373131336462303136
          66323366656539653461663961666338613966663965613330346536363161613961636465646263
          35343533613866643837643233393737393339373039653863373538376662396634386632366137
          30653230386138386164326631386230303437373032663663656432363463633366303666376564
          61636465313763616636633238633639376165333139353461353337343536376437313032336334
          63326435383536623630383737316531333339613738306137383762343139353534
    portainer_use_letsencrypt: true
  roles:
    - role: portainer
